{% extends "base.html" %}
{% block title %}Confirmation{% endblock %}

{% block content %}
<h2 align='center'>ORDER DETAILS</h2>
<p>Order ID: {{ order.order_id }}</p>
<p>Order Date: {{ order.order_date.strftime('%Y-%m-%d %H:%M') }}</p>

{% macro calc_total(order_items) %}
    {% set ns = namespace(total=0) %}
    {% for order_item in order_items %}
        {% set ns.total = ns.total + order_item.total_price %}
    {% endfor %}
    {{ ns.total }}
{% endmacro %}

<table class="table table-striped">
    <thead>
        <tr>
            <th>Product Name</th>
            <th>Price per Unit</th>
            <th>Quantity</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for order_item in order.order_items %}
        <tr>
            <td>{{ order_item.product.productName }}</td>
            <td>₹ {{ order_item.product.productPrice }}</td>
            <td>{{ order_item.quantity }}</td>
            <td>₹ {{ order_item.total_price }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3 align = 'right' style = 'margin-left: 20px'>Total Bill: ₹ {{ calc_total(order.order_items) }}</h3>
<br><br>

<a href="{{ url_for('views.download_bill', order_id=order.id) }}" class="btn btn-primary">Download Bill</a>
<a href="{{ url_for('views.send_email', order_id=order.id) }}" class="btn btn-primary">Get Bill via E-Mail</a>

{% endblock %}
